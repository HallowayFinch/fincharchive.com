<!-- /_includes/share.html -->
{% comment %}
Renders:
- Optional "Source" (with icon) if page.source_url is present
- A Share button (Web Share API + clipboard fallback)
- Automatically prepends a · separator
Usage: place directly after the date line in layouts.
{% endcomment %}

<span class="meta-actions">
  <span aria-hidden="true">·</span>

  {%- if page.source_url -%}
    <a class="meta-link" href="{{ page.source_url }}" target="_blank" rel="noopener">
      Source
      <svg class="icon" aria-hidden="true"><use href="#icon-external"/></svg>
      <span class="visually-hidden">(opens in new tab)</span>
    </a>
    <span aria-hidden="true">·</span>
  {%- endif -%}

  <button class="share-inline" type="button" id="share-btn" aria-label="Share this page">
    <svg class="icon" aria-hidden="true"><use href="#icon-share"/></svg>
  </button>
</span>

<script>
(function () {
  var btn = document.getElementById('share-btn');
  if (!btn) return;

  var title = (document.querySelector('h1') && document.querySelector('h1').textContent.trim()) || document.title;
  var url   = window.location.href;

  btn.addEventListener('click', async function () {
    try {
      if (navigator.share) {
        await navigator.share({ title: title, url: url });
      } else if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(url);
        var old = btn.innerHTML;
        btn.setAttribute('aria-label','Link copied');
        btn.innerHTML = '✓';
        setTimeout(function(){ btn.innerHTML = old; btn.setAttribute('aria-label','Share this page'); }, 1400);
      } else {
        prompt('Copy this link:', url);
      }
    } catch (e) { /* user canceled; no-op */ }
  });
})();
</script>

<style>
.meta-actions { display:inline-flex; gap:.45rem; align-items:center; }
.meta-link { display:inline-flex; gap:.35rem; align-items:center; }
</style>