{% comment %}
SEO + JSON-LD (safe version, no where_exp)
- Basic meta
- Open Graph / Twitter
- Organization, WebSite (with SearchAction)
- Optional BlogPosting on log/field-note pages
- Optional BreadcrumbList for logs pages
{% endcomment %}

{%- assign og_title = page.title | default: site.title -%}
{%- assign og_desc  = page.excerpt | default: site.description -%}
{%- assign og_url   = page.url | absolute_url -%}
{%- assign og_img   = page.og_image | default: '/assets/og/og-default.png' | absolute_url -%}

<title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
<meta name="description" content="{{ og_desc | strip_html | strip_newlines | truncate: 160 }}">
<link rel="canonical" href="{{ og_url }}">

<!-- Open Graph -->
<meta property="og:type" content="{% if page.collection %}article{% else %}website{% endif %}">
<meta property="og:title" content="{{ og_title }}">
<meta property="og:description" content="{{ og_desc | strip_html | strip_newlines }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:image" content="{{ og_img }}">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_desc | strip_html | strip_newlines }}">
<meta name="twitter:image" content="{{ og_img }}">

<!-- Feed discovery -->
<link rel="alternate" type="application/rss+xml" title="{{ site.title }} — Main" href="{{ '/feed.xml' | absolute_url }}">
<link rel="alternate" type="application/rss+xml" title="{{ site.title }} — Logs" href="{{ '/logs/feed.xml' | absolute_url }}">
<link rel="alternate" type="application/rss+xml" title="{{ site.title }} — Field Notes" href="{{ '/field-notes/feed.xml' | absolute_url }}">

<!-- Browser UI tint -->
<meta name="theme-color" media="(prefers-color-scheme: dark)"  content="#000000">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#f6f2e7">
<meta name="color-scheme" content="dark light">

{%- assign site_url = site.url | default: site.github.url | default: "" -%}
{%- assign abs_site = site_url | absolute_url -%}

<!-- Organization -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ site.title | jsonify }},
  "url": {{ abs_site | jsonify }},
  "logo": {{ "/assets/og/og-default.png" | absolute_url | jsonify }}
}
</script>

<!-- WebSite (with SearchAction) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ site.title | jsonify }},
  "url": {{ abs_site | jsonify }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ abs_site }}/search/?q={% raw %}{query}{% endraw %}",
    "query-input": "required name=query"
  }
}
</script>

{%- assign is_log = false -%}
{%- if page.collection == "logs" or page.layout == "log" -%}{% assign is_log = true %}{%- endif -%}
{%- assign is_field = false -%}
{%- if page.collection == "field-notes" or page.layout == "fieldnote" -%}{% assign is_field = true %}{%- endif -%}

{%- if is_log or is_field -%}
  {%- assign author_name = page.author | default: site.author.name | default: "Halloway Finch" -%}
  {%- assign kw = page.tags | join: ", " -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": {{ og_title | jsonify }},
  "description": {{ og_desc | strip_html | strip_newlines | truncate: 200 | jsonify }},
  "url": {{ og_url | jsonify }},
  "image": {{ og_img | jsonify }},
  "author": { "@type": "Person", "name": {{ author_name | jsonify }} },
  "datePublished": {{ page.date | date_to_xmlschema | jsonify }},
  "dateModified": {{ page.last_modified_at | default: page.date | date_to_xmlschema | jsonify }},
  "mainEntityOfPage": { "@type": "WebPage", "@id": {{ og_url | jsonify }} },
  "keywords": {{ kw | jsonify }}
}
</script>
{%- endif -%}

{%- comment -%}
BreadcrumbList (only on logs index and individual log pages).
{%- endcomment -%}
{%- assign is_logs_index = false -%}
{%- if page.url == "/logs/" or page.permalink == "/logs/" or page.layout == "logs" -%}{% assign is_logs_index = true %}{%- endif -%}

{%- if is_logs_index or is_log -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ abs_site | jsonify }}
    }
    {%- if is_logs_index -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Logs",
      "item": {{ (abs_site | append: "/logs/") | jsonify }}
    }
    {%- elsif is_log -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Logs",
      "item": {{ (abs_site | append: "/logs/") | jsonify }}
    },{
      "@type": "ListItem",
      "position": 3,
      "name": {{ og_title | jsonify }},
      "item": {{ og_url | jsonify }}
    }
    {%- endif -%}
  ]
}
</script>
{%- endif -%}